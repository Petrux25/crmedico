{% extends 'base.html' %}
{% block content %}

<div class="container">
    <div class="row">
        <h2 class="card-title font-weight-bold mt-2 m-auto p-5">Agendar cita</h2>
    </div>
    <div class="row">
        <h4 class="card-title font-weight-bold mt-2 m-auto p-1">Dr. {{med.last_name}}</h4>
    </div>
    <div class="row">
        <h4 class="card-title font-weight-bold mt-2 m-auto p-1">{{med.service.get_specialty_display}}</h4>
    </div>
    <form action="{% url 'reservations:save' %}" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-sm-6 m-auto">
                <div class="form-group mt-5">
                    <h6 class="font-weight-bold">Seleccione la fecha</h6>
                    <div class="input-group date" id="datetimepicker4" data-target-input="nearest">
                        <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker4"
                            name="date" id="date_input" />
                        <div class="input-group-append" data-target="#datetimepicker4" data-toggle="datetimepicker">
                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                $(function () {
                    $('#datetimepicker4').datetimepicker({
                        format: 'L'
                    });

                    $("#datetimepicker4").on("change.datetimepicker", function (e) {

                        let csrfmiddlewaretoken = $("[name=csrfmiddlewaretoken]").val();
                        let data = {
                            date: $("#date_input").val(),
                            csrfmiddlewaretoken: csrfmiddlewaretoken,
                            usr: $("#usr").val()
                        }
                        $.ajax({
                            type: "POST",
                            url: "/reservations/times",
                            data: data,
                            dataType: "json",
                            success: function (times) {
                                $("#select1").html("")
                                times.forEach(element => {
                                    $("#select1").append(`<option value="${element.id}">${element.time}</option>`)
                                });
                            }
                        });

                    });
                });
            </script>

        </div>
        <div class="row">
            <div class="col-sm-6 m-auto">
                <div class="form-group">
                    <h6 class="font-weight-bold">Seleccione la hora</h6>
                    <select id="select1" name="time" class="form-control" required>
                        <option value="{{time.id}}">{{time.time}}</option>

                    </select>
                </div>
            </div>
        </div>
        <div class="row d-flex">
            <input name="usr" id="username" type="hidden" value="{{username}}">
            <button id="submit_btn" class="btn btn-primary btn-lg font-weight-bold m-auto justify-content-center">
                <i class="fas fa-pencil-alt"></i> Reservar
            </button>
        </div>
    </form>
</div>

{% endblock %}